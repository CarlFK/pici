# Ansible managed

proxy_cache_path /srv/streaming-frontend/hls levels=1:2 keys_zone=hls-cache:8m max_size=1000m inactive=600m;

server {
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  server_name {{ domain_name }};

  ssl_certificate /etc/ssl/ansible/certs/streaming_frontend.fullchain.pem;
  ssl_certificate_key /etc/ssl/ansible/private/streaming_frontend.key;

  add_header Strict-Transport-Security max-age=15768000;

  root {{ streaming.frontend.data_root }}/www;

  index index.html;

  location /live {
    root {{ streaming.frontend.data_root }}/hls;
    autoindex on;
  }

  location /snmp/ {
    include proxy_params;
    proxy_pass http://unix:/run/gunicorn.sock;
  }

  access_log /var/log/nginx/streaming-frontend-access.log;
  error_log /var/log/nginx/streaming-frontend-error.log;
}
